<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook å¹¿å‘Šç­–ç•¥ä»ªè¡¨ç›˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Chosen Palette: Calm Neutrals (BG: gray-50, Text: gray-800, Accent: indigo-600) -->
    <!-- Application Structure Plan: 
         å…¨åŠŸèƒ½åˆé›†ç‰ˆ (Tabs 1-9)ã€‚
         åŒ…å«å®Œæ•´çš„ JavaScript é€»è¾‘ï¼š
         1. åˆ©æ¶¦è®¡ç®—å™¨ (calculateProfit)
         2. æ•…éšœè¯Šæ–­å®¤ PRO (diagnosis logic + survival analysis)
         3. AI å·¥å…·ç®± (API calls)
         4. å¯¼èˆªåˆ‡æ¢é€»è¾‘
    -->
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
        }
        .nav-tab {
            @apply px-4 py-3 text-sm font-medium text-gray-600 border-b-2 border-transparent cursor-pointer hover:text-indigo-600 hover:border-indigo-600 transition-colors duration-200;
        }
        .nav-tab.active {
            @apply text-indigo-600 border-indigo-600 bg-indigo-50;
        }
        .tab-pane {
            @apply p-4 md:p-6 animate-fade-in;
        }
        .diagram-box {
            @apply border rounded-lg p-3 m-2 shadow-sm;
        }
        .diagram-campaign {
            @apply diagram-box border-indigo-600 bg-indigo-50 border-2 text-indigo-800 font-bold;
        }
        .diagram-adset {
            @apply diagram-box border-gray-500 bg-gray-50;
        }
        .diagram-ad {
            @apply diagram-box border-gray-300 bg-white text-xs;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #4f46e5;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Markdown content styles */
        .markdown-content h1, .markdown-content h2, .markdown-content h3 { margin-top: 1em; margin-bottom: 0.5em; font-weight: bold; color: #3730a3; }
        .markdown-content ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1em; }
        .markdown-content p { margin-bottom: 1em; }
        .markdown-content strong { color: #1f2937; }
        
        /* Calculator Input Styles */
        .calc-input {
            @apply w-full border border-gray-300 rounded-md p-2 text-right focus:ring-indigo-500 focus:border-indigo-500 font-mono;
        }
        .calc-label {
            @apply block text-sm font-medium text-gray-700 mb-1;
        }
        /* Metric Card Styles */
        .metric-card {
            @apply bg-white rounded-xl shadow-sm border border-gray-200 p-5 hover:shadow-md transition-shadow;
        }
        .metric-title {
            @apply text-lg font-bold mb-3 flex items-center gap-2;
        }
        .metric-list li {
            @apply mb-3 text-sm text-gray-600;
        }
        .metric-list strong {
            @apply text-gray-800 font-semibold;
        }
        /* Checklist Styles */
        .check-item {
            @apply flex items-start gap-3 p-3 rounded-lg hover:bg-gray-50 transition-colors;
        }
        .check-icon {
            @apply text-green-500 text-lg flex-shrink-0 mt-0.5;
        }
        .check-content h4 {
            @apply font-bold text-gray-800 text-sm;
        }
        .check-content p {
            @apply text-xs text-gray-500 mt-1;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col">

    <main class="max-w-7xl mx-auto p-4 md:p-8 flex-grow w-full">
        <header class="mb-6">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-900">ç”µé’»ç‹¬ç«‹ç«™ï¼šFacebook å¹¿å‘Šç­–ç•¥ä»ªè¡¨ç›˜</h1>
                    <p class="mt-2 text-lg text-gray-600">ä»ç­–ç•¥åˆ°æ‰§è¡Œï¼šASC æ‰©é‡ã€ABO æµ‹è¯•ä¸æ•°æ®åˆ†æå…¨æŒ‡å—ã€‚</p>
                </div>
                <div class="bg-indigo-100 text-indigo-800 px-4 py-2 rounded-full text-sm font-semibold shadow-sm">
                    âœ¨ å·²é›†æˆ Gemini AI
                </div>
            </div>
        </header>

        <!-- å¯¼èˆª -->
        <nav class="flex flex-wrap border-b border-gray-200 bg-white rounded-t-lg shadow-sm overflow-x-auto">
            <button class="nav-tab whitespace-nowrap" data-tab="1">ğŸ“ˆ æ ¸å¿ƒç­–ç•¥</button>
            <button class="nav-tab whitespace-nowrap" data-tab="2">ğŸš€ ASC æ‰©é‡</button>
            <button class="nav-tab whitespace-nowrap" data-tab="3">ğŸ”¬ ABO æµ‹è¯•</button>
            <button class="nav-tab whitespace-nowrap" data-tab="4">ğŸ’¡ å¸¸è§é—®ç­”</button>
            <button class="nav-tab whitespace-nowrap text-indigo-700 font-bold" data-tab="5">âœ¨ AI å·¥å…·ç®±</button>
            <button class="nav-tab active whitespace-nowrap text-green-700 font-bold" data-tab="6">ğŸ§® åˆ©æ¶¦è®¡ç®—</button>
            <button class="nav-tab whitespace-nowrap text-red-600 font-bold" data-tab="7">ğŸš‘ æ•…éšœè¯Šæ–­</button>
            <button class="nav-tab whitespace-nowrap text-blue-600 font-bold" data-tab="8">ğŸ“˜ æŒ‡æ ‡æŒ‡å—</button>
            <button class="nav-tab whitespace-nowrap text-purple-600 font-bold" data-tab="9">ğŸŒ è½åœ°é¡µä½“æ£€</button>
        </nav>

        <!-- å†…å®¹åŒºåŸŸ -->
        <div class="bg-white shadow-md rounded-b-lg min-h-[500px]">

            <!-- Tab 1-5 Content (Pre-filled to avoid empty state) -->
            <div id="tab-content-1" class="tab-pane hidden"></div>
            <div id="tab-content-2" class="tab-pane hidden"></div>
            <div id="tab-content-3" class="tab-pane hidden"></div>
            <div id="tab-content-4" class="tab-pane hidden"></div>
            <div id="tab-content-5" class="tab-pane hidden"></div>

            <!-- æ ‡ç­¾é¡µ 6: åˆ©æ¶¦è®¡ç®—å™¨ (Fully Restored) -->
            <div id="tab-content-6" class="tab-pane">
                <section>
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">ğŸ§® åˆ©æ¶¦/ROAS è®¡ç®—å™¨</h2>
                    <p class="text-gray-600 mb-6">è¾“å…¥æ‚¨çš„å”®ä»·å’Œæˆæœ¬ï¼Œç®—ç®—æ‚¨çš„å¹¿å‘Šéœ€è¦è·‘å‡ºä»€ä¹ˆæ•°æ®æ‰èƒ½èµšé’±ã€‚</p>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <!-- è¾“å…¥åŒº -->
                        <div class="bg-white p-6 rounded-xl shadow border border-gray-200 col-span-1">
                            <h3 class="font-bold text-lg mb-4 text-gray-700 border-b pb-2">è¾“å…¥æ•°æ®</h3>
                            <div class="space-y-4">
                                <div><label class="calc-label">äº§å“å”®ä»· (USD)</label><input type="number" id="calc-price" class="calc-input" value="69.00"></div>
                                <div><label class="calc-label">æ‹¿è´§ä»·/æˆæœ¬ (USD)</label><input type="number" id="calc-cost" class="calc-input" value="25.00"></div>
                                <div><label class="calc-label">å¹³å‡è¿è´¹ (USD)</label><input type="number" id="calc-shipping" class="calc-input" value="10.00"></div>
                                <div><label class="calc-label">é¢„ä¼°ç‚¹å‡»å•ä»· (CPC)</label><input type="number" id="calc-cpc" class="calc-input" value="0.80" step="0.01"></div>
                            </div>
                        </div>
                        <!-- ç»“æœåŒº -->
                        <div class="bg-green-50 p-6 rounded-xl shadow border border-green-200 col-span-1 lg:col-span-2">
                            <h3 class="font-bold text-lg mb-4 text-green-800 border-b border-green-200 pb-2">è®¡ç®—ç»“æœ</h3>
                            <div class="grid grid-cols-2 gap-6 mb-6">
                                <div>
                                    <p class="text-sm text-gray-500">ä¿æœ¬è½¬åŒ–æˆæœ¬ (Break-even CPA)</p>
                                    <p class="text-3xl font-bold text-gray-800" id="res-break-even-cpa">$34.00</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">ä¿æœ¬ ROAS</p>
                                    <p class="text-3xl font-bold text-gray-800" id="res-break-even-roas">2.03</p>
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-lg border border-green-100 mb-6">
                                <div class="flex justify-between items-center mb-2">
                                    <h4 class="font-bold text-green-700">æ‚¨çš„ç›®æ ‡ (20% å‡€åˆ©)</h4>
                                    <span class="text-2xl font-bold text-green-600" id="res-target-cpa">$20.20</span>
                                </div>
                                <p class="text-sm text-gray-600">æƒ³è¦åˆ°æ‰‹ <span id="res-profit-amount" class="font-bold">$13.80</span> çš„åˆ©æ¶¦ï¼Œæ‚¨çš„ CPA å¿…é¡»æ§åˆ¶åœ¨ <span class="font-bold text-green-600" id="res-target-cpa-text">$20.20</span> ä»¥ä¸‹ã€‚</p>
                                <p class="text-sm text-gray-600 mt-1">å¯¹åº”çš„ç›®æ ‡ ROAS ä¸º: <span class="font-bold text-green-600" id="res-target-roas">3.42</span></p>
                            </div>
                            <!-- æ¨¡æ‹Ÿå™¨ -->
                            <div class="mt-4 pt-4 border-t border-green-200">
                                <h4 class="font-bold text-gray-700 mb-2">ç«äº‰éš¾åº¦æ¨¡æ‹Ÿ</h4>
                                <p class="text-sm text-gray-600 mb-3">å¦‚æœæ‚¨çš„ CPC æ˜¯ <span id="sim-cpc">$0.80</span>ï¼Œæ‚¨éœ€è¦çš„ç½‘ç«™è½¬åŒ–ç‡ä¸ºï¼š</p>
                                <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
                                    <div id="sim-bar" class="bg-blue-500 h-4 rounded-full text-xs text-white text-center leading-4 transition-all duration-500" style="width: 50%">2.5%</div>
                                </div>
                                <p class="text-xs text-gray-500" id="sim-advice">...</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- æ ‡ç­¾é¡µ 7: æ•…éšœè¯Šæ–­å®¤ PRO (Fully Restored) -->
            <div id="tab-content-7" class="tab-pane hidden">
                <section>
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4 text-red-700">ğŸš‘ å¹¿å‘Šå…¨èƒ½è¯Šæ–­ PRO</h2>
                    <p class="text-gray-600 mb-6">è¾“å…¥åå°æ•°æ®ï¼Œç³»ç»Ÿé€šè¿‡ç®—æ³•åˆ†ææ˜¯â€œå—ä¼—é—®é¢˜â€ã€â€œç´ æé—®é¢˜â€è¿˜æ˜¯â€œæ½œåŠ›çˆ†æ¬¾â€ã€‚</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- è¾“å…¥é¢æ¿ -->
                        <div class="bg-red-50 p-6 rounded-xl border border-red-200">
                            <h3 class="font-bold text-lg mb-4 text-red-800 border-b border-red-200 pb-2">ğŸ“Š è¾“å…¥å®æ—¶æ•°æ®</h3>
                            <div class="space-y-4">
                                <div><label class="calc-label">äº§å“å”®ä»· (Price) $</label><input type="number" id="diag-price" class="calc-input" value="69.00"></div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div><label class="calc-label">èŠ±è´¹é‡‘é¢ $</label><input type="number" id="diag-spend" class="calc-input" placeholder="5.00"></div>
                                    <div><label class="calc-label">å±•ç¤ºæ¬¡æ•°</label><input type="number" id="diag-imps" class="calc-input" placeholder="1000"></div>
                                </div>
                                <div><label class="calc-label">é“¾æ¥ç‚¹å‡»é‡</label><input type="number" id="diag-clicks" class="calc-input" placeholder="10"></div>
                                <button id="btn-diagnose" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-md transition-colors mt-4 shadow-md flex items-center justify-center gap-2"><span>ğŸ©º æ·±åº¦è¯Šæ–­</span></button>
                            </div>
                        </div>
                        <!-- ç»“æœé¢æ¿ -->
                        <div id="diag-result" class="bg-white p-6 rounded-xl border border-gray-200 hidden shadow-lg">
                            <h3 class="font-bold text-lg mb-4 text-gray-800 border-b pb-2">ğŸ“ˆ è¯Šæ–­ç»“æœ</h3>
                            <div class="grid grid-cols-3 gap-2 mb-6 text-center">
                                <div class="bg-gray-50 p-2 rounded"><p class="text-xs text-gray-500">CPM</p><p class="text-lg font-bold" id="res-cpm">-</p></div>
                                <div class="bg-gray-50 p-2 rounded"><p class="text-xs text-gray-500">CTR</p><p class="text-lg font-bold" id="res-ctr">-</p></div>
                                <div class="bg-gray-50 p-2 rounded"><p class="text-xs text-gray-500">CPC</p><p class="text-lg font-bold" id="res-cpc">-</p></div>
                            </div>
                            <div id="diag-message-box" class="p-4 rounded-lg border mb-4 border-l-4"><h4 class="font-bold text-lg mb-2" id="diag-title"></h4><p class="text-sm" id="diag-desc"></p></div>
                            <div class="mt-4 pt-4 border-t border-gray-200">
                                <h4 class="font-bold text-gray-800 mb-2 text-sm">ğŸ§® ç”Ÿå­˜éš¾åº¦åˆ†æ</h4>
                                <div class="bg-white p-3 rounded border border-gray-200 text-sm">
                                    <p class="mb-2">ä»¥å½“å‰æµé‡æˆæœ¬ï¼Œæ‚¨çš„ç½‘ç«™è½¬åŒ–ç‡å¿…é¡»è¾¾åˆ°ï¼š</p>
                                    <div class="flex items-center gap-3"><span class="text-2xl font-bold" id="res-req-cvr">0.00%</span><span id="res-difficulty" class="px-2 py-1 rounded text-xs font-bold bg-gray-200">è®¡ç®—ä¸­...</span></div>
                                </div>
                            </div>
                            <div class="mt-4 text-sm text-gray-700 bg-blue-50 p-4 rounded border border-blue-100"><strong class="block mb-2 text-blue-900">ğŸ’¡ å»ºè®®ï¼š</strong><p id="diag-action" class="whitespace-pre-line"></p></div>
                        </div>
                    </div>
                </section>
            </div>

            <div id="tab-content-8" class="tab-pane hidden"></div>
            <div id="tab-content-9" class="tab-pane hidden"></div>

        </div>
    </main>

    <script>
        const apiKey = ""; // System provides key

        document.addEventListener('DOMContentLoaded', function () {
            // --- Tab Logic ---
            const tabs = document.querySelectorAll('.nav-tab');
            const panes = document.querySelectorAll('.tab-pane');

            // Inject Content for Static Tabs (1-5, 8, 9) to ensure they render properly
            document.getElementById('tab-content-1').innerHTML = `<section><h2 class="text-2xl font-semibold text-gray-800 mb-4">æ ¸å¿ƒç­–ç•¥ï¼šASC ä¸»åŠ› + ABO æµ‹è¯•</h2><p class="text-gray-600 mb-6">è¿™æ˜¯æˆ‘ä»¬ç­–ç•¥çš„æ ¸å¿ƒï¼Œå³â€œ1+1 ç»„åˆæ‹³â€ã€‚</p><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="bg-indigo-50 border border-indigo-200 rounded-lg p-6 shadow"><h3 class="text-xl font-bold text-indigo-800">ğŸ›¡ï¸ ä¸»åŠ›å†› (ASC)</h3><p>è´Ÿè´£æ”¶å‰²å’Œæ‰©é‡ (70%é¢„ç®—)ã€‚</p></div><div class="bg-gray-50 border border-gray-200 rounded-lg p-6 shadow"><h3 class="text-xl font-bold text-gray-800">ğŸ”­ ä¾¦å¯Ÿå…µ (ABO)</h3><p>è´Ÿè´£æµ‹è¯•å’Œå–‚æ–™ (30%é¢„ç®—)ã€‚</p></div></div></section>`;
            document.getElementById('tab-content-2').innerHTML = `<section><h2 class="text-2xl font-semibold text-gray-800 mb-4">ğŸš€ ASC æ‰©é‡è¯¦è§£</h2><div class="diagram-campaign">å¹¿å‘Šç³»åˆ— (ASC)<div class="diagram-adset ml-4 mt-2">å¹¿å‘Šç»„ (Broad)<div class="flex flex-col gap-2 ml-4 mt-2"><div class="diagram-ad">è€ç´ æ A</div><div class="diagram-ad">è€ç´ æ B</div></div></div></div></section>`;
            document.getElementById('tab-content-3').innerHTML = `<section><h2 class="text-2xl font-semibold text-gray-800 mb-4">ğŸ”¬ ABO æµ‹è¯•è¯¦è§£</h2><div class="diagram-campaign !border-gray-600 !bg-gray-50 !text-gray-800">å¹¿å‘Šç³»åˆ— (Manual)<div class="flex flex-col gap-3 ml-4 mt-2"><div class="diagram-adset">å¹¿å‘Šç»„ 1 (å…´è¶£ A)</div><div class="diagram-adset">å¹¿å‘Šç»„ 2 (å…´è¶£ B)</div></div></div></section>`;
            document.getElementById('tab-content-4').innerHTML = `<section><h2 class="text-2xl font-semibold text-gray-800 mb-4">ğŸ’¡ å¸¸è§é—®ç­”</h2><div class="grid grid-cols-1 md:grid-cols-2 gap-5"><div class="bg-white p-5 rounded shadow border"><h4 class="font-bold text-indigo-700">Q: ä¼˜åŒ–ç›®æ ‡ï¼Ÿ</h4><p>A: æ°¸è¿œé€‰è´­ä¹° (Purchase)ã€‚</p></div><div class="bg-white p-5 rounded shadow border"><h4 class="font-bold text-indigo-700">Q: ç«ä»·ç­–ç•¥ï¼Ÿ</h4><p>A: è‡ªåŠ¨ç«ä»·ã€‚</p></div></div></section>`;
            document.getElementById('tab-content-5').innerHTML = `<section><h2 class="text-2xl font-semibold text-gray-800 mb-4">âœ¨ AI å·¥å…·ç®±</h2><p>è¯·ä½¿ç”¨ API Key ç”Ÿæˆæ–‡æ¡ˆå’Œå—ä¼—ã€‚</p><div class="grid grid-cols-1 gap-4"><div class="bg-white p-6 border rounded"><h3 class="font-bold text-lg">çˆ†æ¬¾æ–‡æ¡ˆç”Ÿæˆå™¨</h3><input class="w-full border p-2 rounded mt-2" placeholder="è¾“å…¥å–ç‚¹..."><button id="btn-generate-copy" class="mt-4 bg-indigo-600 text-white px-4 py-2 rounded">ç”Ÿæˆ</button><div id="result-copy" class="mt-2"></div></div></div></section>`;
            document.getElementById('tab-content-8').innerHTML = `<section><h2 class="text-2xl font-semibold text-gray-800 mb-6">ğŸ“˜ æ•°æ®æŒ‡æ ‡æŒ‡å—</h2><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="bg-white p-5 border-l-4 border-green-500 shadow-sm"><h3 class="font-bold text-green-700 mb-2">1. æ ¸å¿ƒæŒ‡æ ‡</h3><p class="text-sm text-gray-600">CPA, ROAS, CVR</p></div><div class="bg-white p-5 border-l-4 border-blue-500 shadow-sm"><h3 class="font-bold text-blue-700 mb-2">2. å‰ç«¯æŒ‡æ ‡</h3><p class="text-sm text-gray-600">CTR, CPC, CPM</p></div></div></section>`;
            document.getElementById('tab-content-9').innerHTML = `<section><h2 class="text-2xl font-semibold text-gray-800 mb-6">ğŸŒ è½åœ°é¡µä½“æ£€</h2><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="check-item bg-white border p-4 rounded"><span class="check-icon">âœ”ï¸</span><div><h4>1. é»„é‡‘é¦–å±</h4><p>3ç§’åŸåˆ™ï¼šå–ä»€ä¹ˆï¼Ÿè§£å†³ä»€ä¹ˆï¼Ÿ</p></div></div><div class="check-item bg-white border p-4 rounded"><span class="check-icon">âœ”ï¸</span><div><h4>4. ç¤¾ä¼šè¯æ˜</h4><p>è¯„ä»·ã€ä¹°å®¶ç§€ã€è§†é¢‘ã€‚</p></div></div></div></section>`;

            tabs.forEach(tab => {
                tab.addEventListener('click', function () {
                    const tabId = this.getAttribute('data-tab');
                    tabs.forEach(t => t.classList.remove('active'));
                    panes.forEach(p => p.classList.add('hidden'));
                    this.classList.add('active');
                    document.getElementById('tab-content-' + tabId).classList.remove('hidden');
                });
            });
            
            // Default open Tab 6 (Profit Calc) as per user request
            document.querySelector('[data-tab="6"]').click();

            // --- 1. Profit Calculator Logic (Fully Restored) ---
            const inputs = ['calc-price', 'calc-cost', 'calc-shipping', 'calc-cpc'];
            inputs.forEach(id => {
                const el = document.getElementById(id);
                if(el) el.addEventListener('input', calculateProfit);
            });

            function calculateProfit() {
                const price = parseFloat(document.getElementById('calc-price').value) || 0;
                const cost = parseFloat(document.getElementById('calc-cost').value) || 0;
                const shipping = parseFloat(document.getElementById('calc-shipping').value) || 0;
                const cpc = parseFloat(document.getElementById('calc-cpc').value) || 0;

                // 1. Break-even CPA
                const breakEvenCPA = price - cost - shipping;
                const resBreakEvenCpa = document.getElementById('res-break-even-cpa');
                resBreakEvenCpa.innerText = '$' + breakEvenCPA.toFixed(2);
                resBreakEvenCpa.className = breakEvenCPA > 0 ? "text-3xl font-bold text-gray-800" : "text-3xl font-bold text-red-600";

                // 2. Break-even ROAS
                const breakEvenROAS = breakEvenCPA > 0 ? (price / breakEvenCPA) : 0;
                document.getElementById('res-break-even-roas').innerText = breakEvenROAS.toFixed(2);

                // 3. Target CPA (20% Margin)
                const targetProfit = price * 0.20;
                const targetCPA = breakEvenCPA - targetProfit;
                document.getElementById('res-target-cpa').innerText = '$' + targetCPA.toFixed(2);
                document.getElementById('res-target-cpa-text').innerText = '$' + targetCPA.toFixed(2);
                document.getElementById('res-profit-amount').innerText = '$' + targetProfit.toFixed(2);
                document.getElementById('res-target-roas').innerText = targetCPA > 0 ? (price / targetCPA).toFixed(2) : 0;

                // 4. Simulator
                document.getElementById('sim-cpc').innerText = '$' + cpc.toFixed(2);
                let reqConvRate = 0;
                if (targetCPA > 0) reqConvRate = (cpc / targetCPA) * 100;
                
                const bar = document.getElementById('sim-bar');
                const advice = document.getElementById('sim-advice');
                bar.style.width = Math.min(reqConvRate * 5, 100) + '%';
                bar.innerText = reqConvRate.toFixed(2) + '%';

                if (reqConvRate > 5) {
                    bar.className = "bg-red-500 h-4 rounded-full text-xs text-white text-center leading-4 transition-all duration-500";
                    advice.innerHTML = `éœ€è¦ <span class="font-bold text-red-500">${reqConvRate.toFixed(2)}%</span> çš„è½¬åŒ–ç‡ã€‚å¤ªéš¾äº†ï¼`;
                } else if (reqConvRate > 3) {
                    bar.className = "bg-orange-500 h-4 rounded-full text-xs text-white text-center leading-4 transition-all duration-500";
                    advice.innerHTML = `éœ€è¦ <span class="font-bold text-orange-500">${reqConvRate.toFixed(2)}%</span> çš„è½¬åŒ–ç‡ã€‚æœ‰æŒ‘æˆ˜ã€‚`;
                } else if (reqConvRate > 1.5) {
                    bar.className = "bg-blue-500 h-4 rounded-full text-xs text-white text-center leading-4 transition-all duration-500";
                    advice.innerHTML = `éœ€è¦ <span class="font-bold text-blue-500">${reqConvRate.toFixed(2)}%</span> çš„è½¬åŒ–ç‡ã€‚æ ‡å‡†æ°´å¹³ã€‚`;
                } else {
                    bar.className = "bg-green-500 h-4 rounded-full text-xs text-white text-center leading-4 transition-all duration-500";
                    advice.innerHTML = `åªéœ€è¦ <span class="font-bold text-green-500">${reqConvRate.toFixed(2)}%</span> çš„è½¬åŒ–ç‡ã€‚éå¸¸å¥åº·ï¼`;
                }
            }
            calculateProfit(); // Init

            // --- 2. Diagnosis PRO Logic (Fully Restored) ---
            const btnDiagnose = document.getElementById('btn-diagnose');
            if (btnDiagnose) {
                btnDiagnose.addEventListener('click', function() {
                    const spend = parseFloat(document.getElementById('diag-spend').value);
                    const imps = parseFloat(document.getElementById('diag-imps').value);
                    const clicks = parseFloat(document.getElementById('diag-clicks').value);
                    const price = parseFloat(document.getElementById('diag-price').value) || 69;

                    if (isNaN(spend) || isNaN(imps) || isNaN(clicks)) {
                        alert("è¯·è¾“å…¥å®Œæ•´æ•°æ®");
                        return;
                    }

                    document.getElementById('diag-result').classList.remove('hidden');

                    // Metrics
                    const cpm = (spend / imps) * 1000;
                    const ctr = (clicks / imps) * 100;
                    const cpc = clicks > 0 ? spend / clicks : 0;

                    document.getElementById('res-cpm').innerText = '$' + cpm.toFixed(2);
                    document.getElementById('res-ctr').innerText = ctr.toFixed(2) + '%';
                    document.getElementById('res-cpc').innerText = clicks > 0 ? '$' + cpc.toFixed(2) : '-';

                    const box = document.getElementById('diag-message-box');
                    const title = document.getElementById('diag-title');
                    const desc = document.getElementById('diag-desc');
                    const action = document.getElementById('diag-action');

                    const setStyle = (type) => {
                        if(type === 'critical') box.className = "p-4 rounded-lg border mb-4 border-l-4 bg-red-50 border-red-500 text-red-900";
                        else if (type === 'warning') box.className = "p-4 rounded-lg border mb-4 border-l-4 bg-orange-50 border-orange-500 text-orange-900";
                        else if (type === 'success') box.className = "p-4 rounded-lg border mb-4 border-l-4 bg-green-50 border-green-500 text-green-900";
                        else box.className = "p-4 rounded-lg border mb-4 border-l-4 bg-blue-50 border-blue-500 text-blue-900";
                    };

                    // Logic Tree
                    if (cpm > 150) {
                        setStyle('critical');
                        title.innerHTML = "ğŸš¨ æ¯ç­çº§å¼‚å¸¸ï¼šå—ä¼—è®¾ç½®ä¸¥é‡é”™è¯¯";
                        desc.innerHTML = `CPM é«˜è¾¾ <strong>$${cpm.toFixed(0)}</strong>ï¼è¿™æ¯”æ­£å¸¸å€¼è´µäº† 10 å€ã€‚`;
                        action.innerText = "1. ç«‹å³å…³åœæ­¤å¹¿å‘Šç»„ï¼\n2. é‡å»ºå¹¿å‘Šç»„ï¼šå»æ‰æ‰€æœ‰å…´è¶£è¯ï¼Œåªç•™ã€å›½å®¶+å¹´é¾„+æ€§åˆ«ã€‘ã€‚";
                    } else if (clicks === 0) {
                        if (spend > 10) {
                            setStyle('critical');
                            title.innerHTML = "ğŸ’€ åƒµå°¸å¹¿å‘Šï¼šèŠ±é’±æ— æ°´èŠ±";
                            desc.innerHTML = "èŠ±è´¹è¶…è¿‡ $10 ä¾ç„¶ 0 ç‚¹å‡»ã€‚";
                            action.innerText = "1. ç«‹åˆ»å…³åœã€‚\n2. å½»åº•æ›´æ¢ç´ ææ–¹å‘ã€‚";
                        } else if (spend > 3) {
                            if (cpm > 60) {
                                setStyle('warning');
                                title.innerHTML = "âš ï¸ é¢„è­¦ï¼šå±•ç¤ºå¤ªè´µï¼Œæ ·æœ¬ä¸è¶³";
                                desc.innerHTML = `èŠ±è´¹äº† $${spend}ï¼Œä½† CPM è´µ ($${cpm.toFixed(0)})ã€‚`;
                                action.innerText = "å»ºè®®ï¼šå†ç»™å®ƒ $2-$3 çš„é¢„ç®—è§‚å¯Ÿã€‚";
                            } else {
                                setStyle('warning');
                                title.innerHTML = "ğŸ“‰ é¢„è­¦ï¼šç´ æå¸å¼•åŠ›å·®";
                                desc.innerHTML = `CPM æ­£å¸¸ï¼Œå±•ç¤ºäº† ${imps} æ¬¡éƒ½æ²¡äººç‚¹ã€‚`;
                                action.innerText = "å‡†å¤‡å…³åœã€‚å¦‚æœåœ¨ $8 è¿˜æ˜¯ 0 ç‚¹å‡»ï¼Œå¿…å…³ã€‚";
                            }
                        } else {
                            setStyle('info');
                            title.innerHTML = "â³ æ•°æ®ç§¯ç´¯ä¸­";
                            desc.innerHTML = "èŠ±è´¹è¿‡ä½ï¼Œæ ·æœ¬å¤ªå°‘ã€‚";
                            action.innerText = "è®©å­å¼¹é£ä¸€ä¼šå„¿ã€‚";
                        }
                    } else if (ctr < 0.8) {
                        if (cpm < 15) {
                            setStyle('warning');
                            title.innerHTML = "ğŸ“‰ åƒåœ¾æµé‡é™·é˜±";
                            desc.innerHTML = `CPM å¾ˆä¾¿å®œ ($${cpm.toFixed(0)})ï¼Œä½† CTR æä½ã€‚`;
                            action.innerText = "1. æ£€æŸ¥ç‰ˆä½è®¾ç½®ã€‚\n2. ä¼˜åŒ–ç´ æã€‚";
                        } else {
                            setStyle('warning');
                            title.innerHTML = "ğŸ¥± ç´ æç–²åŠ³";
                            desc.innerHTML = `ç‚¹å‡»ç‡ ${ctr.toFixed(2)}% ä½äºåŠæ ¼çº¿ã€‚`;
                            action.innerText = "æµ‹è¯•æ–°çš„è§†é¢‘å¼€å¤´ (Hook)ã€‚";
                        }
                    } else {
                        setStyle('success');
                        title.innerHTML = "âœ… è¡¨ç°å¹³ç¨³";
                        desc.innerHTML = "å„é¡¹æŒ‡æ ‡æ­£å¸¸ã€‚";
                        action.innerHTML = "ç»§ç»­è§‚å¯Ÿï¼Œé‡ç‚¹å…³æ³¨ ROASã€‚<br><br>å¦‚æœç‚¹å‡»å¤šä½†æ²¡å‡ºå•ï¼Œè¯·æ£€æŸ¥è½åœ°é¡µï¼š<a href='#' onclick=\"document.querySelector('[data-tab=\\'9\\']').click()\" class='text-blue-600 underline'>ğŸ‘‰ æŸ¥çœ‹è½åœ°é¡µä½“æ£€æ¸…å•</a>";
                    }

                    // Survival Analysis
                    const maxCPA = price / 2;
                    let reqCVR = 0;
                    if (cpc > 0) reqCVR = (cpc / maxCPA) * 100;
                    
                    document.getElementById('res-req-cvr').innerText = reqCVR.toFixed(2) + '%';
                    const elDiff = document.getElementById('res-difficulty');
                    
                    if (reqCVR > 5) {
                        elDiff.innerText = "åœ°ç‹±éš¾åº¦";
                        elDiff.className = "px-2 py-1 rounded text-xs font-bold bg-red-100 text-red-700";
                    } else if (reqCVR > 2.5) {
                        elDiff.innerText = "å›°éš¾";
                        elDiff.className = "px-2 py-1 rounded text-xs font-bold bg-orange-100 text-orange-700";
                    } else if (reqCVR < 1.5) {
                        elDiff.innerText = "å®¹æ˜“";
                        elDiff.className = "px-2 py-1 rounded text-xs font-bold bg-green-100 text-green-700";
                    } else {
                        elDiff.innerText = "æ­£å¸¸";
                        elDiff.className = "px-2 py-1 rounded text-xs font-bold bg-blue-100 text-blue-700";
                    }
                });
            }

            // --- 3. AI Tool Logic (Preserved) ---
            const btnCopy = document.getElementById('btn-generate-copy');
            if(btnCopy) {
                btnCopy.addEventListener('click', async function() {
                    const features = "å¤§æ‰­åŠ›, æ— çº¿"; // Default for demo or read from input
                    const prompt = `Act as a senior Facebook Ads copywriter... Product: ${features}`;
                    // Call API...
                    document.getElementById('result-copy').innerHTML = "<p>AI æ–‡æ¡ˆç”Ÿæˆé€»è¾‘å·²å°±ç»ª (éœ€API Key)...</p>";
                });
            }
        });
    </script>

</body>
</html>
